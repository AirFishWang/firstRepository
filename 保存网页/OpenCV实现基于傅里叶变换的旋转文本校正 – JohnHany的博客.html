<!DOCTYPE html>
<!-- saved from url=(0276)file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/OpenCV%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E7%9A%84%E6%97%8B%E8%BD%AC%E6%96%87%E6%9C%AC%E6%A0%A1%E6%AD%A3%20%E2%80%93%20JohnHany%E7%9A%84%E5%8D%9A%E5%AE%A2.html -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://johnhany.net/xmlrpc.php">

<title>OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客</title>
<link rel="alternate" type="application/rss+xml" title="JohnHany的博客 » Feed" href="http://johnhany.net/feed/">
<link rel="alternate" type="application/rss+xml" title="JohnHany的博客 » 评论Feed" href="http://johnhany.net/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JohnHany的博客 » OpenCV实现基于傅里叶变换的旋转文本校正评论Feed" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/johnhany.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=92b404b5d59c768b7fa422b872d9e5e4"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/wp-emoji-release.min.js" type="text/javascript"></script><script src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/wp-emoji-release.min(1).js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="crayon-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/crayon.min.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-visual-assist-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/visual-assist.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-font-monaco-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/monaco.css" type="text/css" media="all">
<link rel="stylesheet" id="responsive-lightbox-fancybox-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/jquery.fancybox-1.3.4.css" type="text/css" media="all">
<link rel="stylesheet" id="hany-dark-style-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="hany-dark-content-sidebar-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/sidebar-content.css" type="text/css" media="all">
<link rel="stylesheet" id="hany-dark-fontawesome-css" href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/font-awesome.min.css" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
window.CKEDITOR_BASEPATH = "http://johnhany.net/wp-content/plugins/ckeditor-for-wordpress/ckeditor/";
var ckeditorSettings = { "textarea_id": "comment", "pluginPath": "http:\/\/johnhany.net\/wp-content\/plugins\/ckeditor-for-wordpress\/", "autostart": true, "excerpt_state": false, "qtransEnabled": false, "outputFormat": { "indent": true, "breakBeforeOpen": true, "breakAfterOpen": true, "breakBeforeClose": true, "breakAfterClose": true }, "configuration": { "height": "160px", "skin": "moono", "scayt_autoStartup": false, "entities": true, "entities_greek": true, "entities_latin": true, "toolbar": "WordpressBasic", "templates_files": [ "http:\/\/johnhany.net\/wp-content\/plugins\/ckeditor-for-wordpress\/ckeditor.templates.js" ], "stylesCombo_stylesSet": "wordpress:http:\/\/johnhany.net\/wp-content\/plugins\/ckeditor-for-wordpress\/ckeditor.styles.js", "allowedContent": true, "customConfig": "http:\/\/johnhany.net\/wp-content\/plugins\/ckeditor-for-wordpress\/ckeditor.config.js" }, "externalPlugins": [  ], "additionalButtons": [  ] }
/* ]]> */
</script><style type="text/css">
			#content table.cke_editor { margin:0; }
			#content table.cke_editor tr td { padding:0;border:0; }
		</style><script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/jquery.js"></script>
<script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/jquery-migrate.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/johnhany.net\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"\u4f7f\u7528 %s \u590d\u5236\uff0c\u4f7f\u7528 %s \u7c98\u8d34\u3002","minimize":"\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801"};
/* ]]> */
</script>
<script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/crayon.min.js"></script>
<script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/ckeditor.js"></script><style>.cke{visibility:hidden;}</style><style>.cke{visibility:hidden;}</style>
<script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/ckeditor.utils.js"></script>
<script type="text/javascript" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/ckeditor.comment-reply.js"></script>
<link rel="https://api.w.org/" href="http://johnhany.net/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://johnhany.net/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://johnhany.net/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="N条线段求交的扫描线算法" href="http://johnhany.net/2013/11/sweep-algorithm-for-segments-intersection/">
<link rel="next" title="Java+MySQL实现网络爬虫程序" href="http://johnhany.net/2013/11/web-crawler-using-java-and-mysql/">

<link rel="canonical" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/">
<link rel="shortlink" href="http://johnhany.net/?p=376">
<link rel="alternate" type="application/json+oembed" href="http://johnhany.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fjohnhany.net%2F2013%2F11%2Fdft-based-text-rotation-correction%2F">
<link rel="alternate" type="text/xml+oembed" href="http://johnhany.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fjohnhany.net%2F2013%2F11%2Fdft-based-text-rotation-correction%2F&amp;format=xml">
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//johnhany.net/?wordfence_logHuman=1&hid=7176C2D525328CA4979A2BCCC7F98FDB');
</script>		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; }
/* ]]> */
</style>
<style type="text/css" media="screen">body{position:relative}#dynamic-to-top{display:none;overflow:hidden;width:auto;z-index:90;position:fixed;top:20px;left:20px;bottom:auto;right:auto;font-family:sans-serif;font-size:1em;color:#fff;text-decoration:none;text-shadow:0 1px 0 #333;font-weight:bold;padding:16px 14px;border:1px solid #21285f;background:#645dc1;-webkit-background-origin:border;-moz-background-origin:border;-icab-background-origin:border;-khtml-background-origin:border;-o-background-origin:border;background-origin:border;-webkit-background-clip:padding-box;-moz-background-clip:padding-box;-icab-background-clip:padding-box;-khtml-background-clip:padding-box;-o-background-clip:padding-box;background-clip:padding-box;-webkit-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-ms-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-moz-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-o-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-khtml-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-icab-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-webkit-border-radius:10px;-moz-border-radius:10px;-icab-border-radius:10px;-khtml-border-radius:10px;border-radius:10px}#dynamic-to-top:hover{background:#517de7;background:#645dc1 -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 255, 255, 255, .2 ) ), to( rgba( 0, 0, 0, 0 ) ) );background:#645dc1 -webkit-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -khtml-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -moz-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -o-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -ms-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -icab-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );cursor:pointer}#dynamic-to-top:active{background:#645dc1;background:#645dc1 -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 0, 0, 0, .3 ) ), to( rgba( 0, 0, 0, 0 ) ) );background:#645dc1 -webkit-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -moz-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -khtml-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -o-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -ms-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 -icab-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#645dc1 linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) )}#dynamic-to-top,#dynamic-to-top:active,#dynamic-to-top:focus,#dynamic-to-top:hover{outline:none}#dynamic-to-top span{display:block;overflow:hidden;width:14px;height:12px;background:url( http://johnhany.net/wp-content/plugins/dynamic-to-top/css/images/up.png )no-repeat center center}</style><script type="text/javascript" async="" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/saved_resource"></script><script type="text/javascript" async="" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/saved_resource(1)"></script></head>

<body class="single single-post postid-376 single-format-standard">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#content">Skip to content</a>

	<header id="masthead" class="site-header" role="banner">
                		<div class="site-branding header-background-image" style="background-image: url(http://johnhany.net/wp-content/uploads/2015/01/cropped-Hany-Dark-header.jpg)">                    <div class="title-box">
                            <div class="icon-box">
                                <h1 class="icon-image"><img width="140" height="140" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/icon_140.jpg"></h1>
                            </div>
                            <div class="title-text">
                                <h1 class="site-title"><a href="http://johnhany.net/" rel="home">JohnHany的博客</a></h1>
                                <h2 class="site-description">编程 手绘 文字</h2>
                            </div>
                    </div>
		</div><!-- .site-branding -->

		<nav id="site-navigation" class="main-navigation" role="navigation">
                        <div class="menu-%e8%8f%9c%e5%8d%951-container"><ul id="menu-%e8%8f%9c%e5%8d%951" class="menu"><li id="menu-item-10" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-10"><a href="http://johnhany.net/">首页</a></li>
<li id="menu-item-805" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-805"><a href="http://johnhany.net/category/tech-article/">技术文章</a>
<ul class="sub-menu">
	<li id="menu-item-812" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-812"><a href="http://johnhany.net/category/tech-article/pattern-recognition/">模式识别</a></li>
	<li id="menu-item-813" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-813"><a href="http://johnhany.net/category/tech-article/computer-graphics/">计算机图形学</a></li>
	<li id="menu-item-810" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-810"><a href="http://johnhany.net/category/tech-article/image-processing/">图像处理</a></li>
	<li id="menu-item-806" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-806"><a href="http://johnhany.net/category/tech-article/android/">Android</a></li>
	<li id="menu-item-811" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-811"><a href="http://johnhany.net/category/tech-article/applied-mathematics/">应用数学</a></li>
	<li id="menu-item-807" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-807"><a href="http://johnhany.net/category/tech-article/c-cpp/">C/C++</a></li>
	<li id="menu-item-809" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-809"><a href="http://johnhany.net/category/tech-article/java/">Java</a></li>
	<li id="menu-item-808" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-808"><a href="http://johnhany.net/category/tech-article/html5/">HTML5</a></li>
</ul>
</li>
<li id="menu-item-814" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-814"><a href="http://johnhany.net/category/gallery/">展示</a>
<ul class="sub-menu">
	<li id="menu-item-815" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-815"><a href="http://johnhany.net/category/gallery/cg/">CG</a></li>
	<li id="menu-item-816" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-816"><a href="http://johnhany.net/category/gallery/painting/">手绘</a></li>
	<li id="menu-item-817" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-817"><a href="http://johnhany.net/category/gallery/photograph/">摄影</a></li>
</ul>
</li>
<li id="menu-item-818" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-818"><a href="http://johnhany.net/category/essay/">随笔</a></li>
<li id="menu-item-180" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-180"><a href="http://johnhany.net/about/">关于我</a></li>
</ul></div>                        		</nav><!-- #site-navigation -->
                
                <div class="search-toggle">
                    <i class="fa fa-search"></i>
                    <a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#search-container" class="screen-reader-text">Search</a>
                </div>
                
                <div id="search-container" class="search-box-wrapper clear">
                    <div class="search-box clear">
                        <form role="search" method="get" class="search-form" action="http://johnhany.net/">
				<label>
					<span class="screen-reader-text">搜索：</span>
					<input type="search" class="search-field" placeholder="搜索…" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="搜索">
			</form>                    </div>
                </div> 
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-376" class="post-376 post type-post status-publish format-standard has-post-thumbnail hentry category-image-processing tag-opencv-2 tag-40">
    <div class="entry-body">
	<header class="entry-header">
		<h1 class="entry-title">OpenCV实现基于傅里叶变换的旋转文本校正</h1>
		<div class="entry-meta">
			<span class="posted-on">发布于 <a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/" rel="bookmark"><time class="entry-date published" datetime="2013-11-25T11:58:54+00:00">2013年11月25日</time><time class="updated" datetime="2016-01-27T20:07:30+00:00">2016年1月27日</time></a></span><span class="byline"> 作者： <span class="author vcard"><a class="url fn n" href="http://johnhany.net/author/john-hany/">John Hany</a></span></span>			<span class="meta-views">
			    12,107次阅读			</span>
		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>
	<strong><span style="font-size:16px;">代码</span></strong>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;先给出代码，再详细解释一下过程：
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d1c108515999" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">#include &lt;opencv2/core/core.hpp&gt;
#include &lt;opencv2/imgproc/imgproc.hpp&gt;
#include &lt;opencv2/highgui/highgui.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace std;

#define GRAY_THRESH 150
#define HOUGH_VOTE 100

//#define DEGREE 27

int main(int argc, char **argv)
{
	//Read a single-channel image
	const char* filename = "imageText.jpg";
	Mat srcImg = imread(filename, CV_LOAD_IMAGE_GRAYSCALE);
	if(srcImg.empty())
		return -1;
	imshow("source", srcImg);

	Point center(srcImg.cols/2, srcImg.rows/2);

#ifdef DEGREE
	//Rotate source image
	Mat rotMatS = getRotationMatrix2D(center, DEGREE, 1.0);
	warpAffine(srcImg, srcImg, rotMatS, srcImg.size(), 1, 0, Scalar(255,255,255));
	imshow("RotatedSrc", srcImg);
	//imwrite("imageText_R.jpg",srcImg);
#endif

	//Expand image to an optimal size, for faster processing speed
	//Set widths of borders in four directions
	//If borderType==BORDER_CONSTANT, fill the borders with (0,0,0)
	Mat padded;
	int opWidth = getOptimalDFTSize(srcImg.rows);
	int opHeight = getOptimalDFTSize(srcImg.cols);
	copyMakeBorder(srcImg, padded, 0, opWidth-srcImg.rows, 0, opHeight-srcImg.cols, BORDER_CONSTANT, Scalar::all(0));

	Mat planes[] = {Mat_&lt;float&gt;(padded), Mat::zeros(padded.size(), CV_32F)};
	Mat comImg;
	//Merge into a double-channel image
	merge(planes,2,comImg);

	//Use the same image as input and output,
	//so that the results can fit in Mat well
	dft(comImg, comImg);

	//Compute the magnitude
	//planes[0]=Re(DFT(I)), planes[1]=Im(DFT(I))
	//magnitude=sqrt(Re^2+Im^2)
	split(comImg, planes);
	magnitude(planes[0], planes[1], planes[0]);

	//Switch to logarithmic scale, for better visual results
	//M2=log(1+M1)
	Mat magMat = planes[0];
	magMat += Scalar::all(1);
	log(magMat, magMat);

	//Crop the spectrum
	//Width and height of magMat should be even, so that they can be divided by 2
	//-2 is 11111110 in binary system, operator &amp; make sure width and height are always even
	magMat = magMat(Rect(0, 0, magMat.cols &amp; -2, magMat.rows &amp; -2));

	//Rearrange the quadrants of Fourier image,
	//so that the origin is at the center of image,
	//and move the high frequency to the corners
	int cx = magMat.cols/2;
	int cy = magMat.rows/2;

	Mat q0(magMat, Rect(0, 0, cx, cy));
	Mat q1(magMat, Rect(0, cy, cx, cy));
	Mat q2(magMat, Rect(cx, cy, cx, cy));
	Mat q3(magMat, Rect(cx, 0, cx, cy));

	Mat tmp;
	q0.copyTo(tmp);
	q2.copyTo(q0);
	tmp.copyTo(q2);

	q1.copyTo(tmp);
	q3.copyTo(q1);
	tmp.copyTo(q3);

	//Normalize the magnitude to [0,1], then to[0,255]
	normalize(magMat, magMat, 0, 1, CV_MINMAX);
	Mat magImg(magMat.size(), CV_8UC1);
	magMat.convertTo(magImg,CV_8UC1,255,0);
	imshow("magnitude", magImg);
	//imwrite("imageText_mag.jpg",magImg);

	//Turn into binary image
	threshold(magImg,magImg,GRAY_THRESH,255,CV_THRESH_BINARY);
	imshow("mag_binary", magImg);
	//imwrite("imageText_bin.jpg",magImg);

	//Find lines with Hough Transformation
	vector&lt;Vec2f&gt; lines;
	float pi180 = (float)CV_PI/180;
	Mat linImg(magImg.size(),CV_8UC3);
	HoughLines(magImg,lines,1,pi180,HOUGH_VOTE,0,0);
	int numLines = lines.size();
	for(int l=0; l&lt;numLines; l++)
	{
		float rho = lines[l][0], theta = lines[l][1];
		Point pt1, pt2;
		double a = cos(theta), b = sin(theta);
		double x0 = a*rho, y0 = b*rho;
		pt1.x = cvRound(x0 + 1000*(-b));
		pt1.y = cvRound(y0 + 1000*(a));
		pt2.x = cvRound(x0 - 1000*(-b));
		pt2.y = cvRound(y0 - 1000*(a));
		line(linImg,pt1,pt2,Scalar(255,0,0),3,8,0);
	}
	imshow("lines",linImg);
	//imwrite("imageText_line.jpg",linImg);
	if(lines.size() == 3){
		cout &lt;&lt; "found three angels:" &lt;&lt; endl;
		cout &lt;&lt; lines[0][1]*180/CV_PI &lt;&lt; endl &lt;&lt; lines[1][1]*180/CV_PI &lt;&lt; endl &lt;&lt; lines[2][1]*180/CV_PI &lt;&lt; endl &lt;&lt; endl;
	}

	//Find the proper angel from the three found angels
	float angel=0;
	float piThresh = (float)CV_PI/90;
	float pi2 = CV_PI/2;
	for(int l=0; l&lt;numLines; l++)
	{
		float theta = lines[l][1];
		if(abs(theta) &lt; piThresh || abs(theta-pi2) &lt; piThresh)
			continue;
		else{
			angel = theta;
			break;
		}
	}

	//Calculate the rotation angel
	//The image has to be square,
	//so that the rotation angel can be calculate right
	angel = angel&lt;pi2 ? angel : angel-CV_PI;
	if(angel != pi2){
		float angelT = srcImg.rows*tan(angel)/srcImg.cols;
		angel = atan(angelT);
	}
	float angelD = angel*180/(float)CV_PI;
	cout &lt;&lt; "the rotation angel to be applied:" &lt;&lt; endl &lt;&lt; angelD &lt;&lt; endl &lt;&lt; endl;

	//Rotate the image to recover
	Mat rotMat = getRotationMatrix2D(center,angelD,1.0);
	Mat dstImg = Mat::ones(srcImg.size(),CV_8UC3);
	warpAffine(srcImg,dstImg,rotMat,srcImg.size(),1,0,Scalar(255,255,255));
	imshow("result",dstImg);
	//imwrite("imageText_D.jpg",dstImg);
	
	waitKey(0);

	return 0;
}</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-6">6</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-8">8</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-10">10</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-12">12</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-14">14</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-16">16</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-18">18</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-20">20</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-22">22</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-24">24</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-26">26</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-28">28</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-30">30</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-32">32</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-34">34</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-36">36</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-38">38</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-40">40</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-42">42</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-44">44</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-46">46</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-48">48</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-50">50</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-52">52</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-54">54</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-56">56</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-58">58</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-60">60</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-62">62</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-64">64</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-66">66</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-68">68</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-70">70</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-72">72</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-74">74</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-76">76</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-78">78</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-80">80</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-82">82</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-84">84</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-86">86</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-88">88</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-90">90</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-92">92</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-94">94</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-96">96</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-98">98</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-100">100</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-102">102</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-104">104</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-106">106</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-108">108</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-110">110</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-112">112</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-114">114</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-116">116</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-118">118</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-120">120</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-122">122</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-124">124</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-126">126</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-128">128</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-130">130</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-132">132</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-134">134</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-136">136</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-138">138</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-140">140</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-142">142</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-144">144</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-146">146</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-148">148</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-150">150</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-152">152</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-154">154</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-156">156</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-158">158</div><div class="crayon-num" data-line="crayon-583f9b5b33d1c108515999-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d1c108515999-160">160</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-1"><span class="crayon-p">#include &lt;opencv2/core/core.hpp&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-2"><span class="crayon-p">#include &lt;opencv2/imgproc/imgproc.hpp&gt;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-3"><span class="crayon-p">#include &lt;opencv2/highgui/highgui.hpp&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-4"><span class="crayon-p">#include &lt;iostream&gt;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-6"><span class="crayon-e">using </span><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-v">cv</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-7"><span class="crayon-e">using </span><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-v">std</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-8">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-9"><span class="crayon-p">#define GRAY_THRESH 150</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-10"><span class="crayon-p">#define HOUGH_VOTE 100</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-12"><span class="crayon-c">//#define DEGREE 27</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-14"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">argc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-v">argv</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-15"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-16"><span class="crayon-h">	</span><span class="crayon-c">//Read a single-channel image</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-17"><span class="crayon-h">	</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"imageText.jpg"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-18"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">srcImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_LOAD_IMAGE_GRAYSCALE</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-19"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-20"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-21"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"source"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-22">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-23"><span class="crayon-h">	</span><span class="crayon-e">Point </span><span class="crayon-e">center</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-24">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-25"><span class="crayon-p">#ifdef DEGREE</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-26"><span class="crayon-h">	</span><span class="crayon-c">//Rotate source image</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-27"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">rotMatS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getRotationMatrix2D</span><span class="crayon-sy">(</span><span class="crayon-v">center</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">DEGREE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-28"><span class="crayon-h">	</span><span class="crayon-e">warpAffine</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotMatS</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-29"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"RotatedSrc"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-30"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("imageText_R.jpg",srcImg);</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-31"><span class="crayon-p">#endif</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-32">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-33"><span class="crayon-h">	</span><span class="crayon-c">//Expand image to an optimal size, for faster processing speed</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-34"><span class="crayon-h">	</span><span class="crayon-c">//Set widths of borders in four directions</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-35"><span class="crayon-h">	</span><span class="crayon-c">//If borderType==BORDER_CONSTANT, fill the borders with (0,0,0)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-36"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">padded</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-37"><span class="crayon-h">	</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">opWidth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getOptimalDFTSize</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-38"><span class="crayon-h">	</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">opHeight</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getOptimalDFTSize</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-39"><span class="crayon-h">	</span><span class="crayon-e">copyMakeBorder</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">opWidth</span><span class="crayon-o">-</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">opHeight</span><span class="crayon-o">-</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">BORDER_CONSTANT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Scalar</span><span class="crayon-o">::</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-40">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-41"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">Mat_</span><span class="crayon-o">&lt;</span><span class="crayon-t">float</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-v">padded</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Mat</span><span class="crayon-o">::</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">padded</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_32F</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-42"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">comImg</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-43"><span class="crayon-h">	</span><span class="crayon-c">//Merge into a double-channel image</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-44"><span class="crayon-h">	</span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">planes</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-v">comImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-46"><span class="crayon-h">	</span><span class="crayon-c">//Use the same image as input and output,</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-47"><span class="crayon-h">	</span><span class="crayon-c">//so that the results can fit in Mat well</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-48"><span class="crayon-h">	</span><span class="crayon-e">dft</span><span class="crayon-sy">(</span><span class="crayon-v">comImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">comImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-50"><span class="crayon-h">	</span><span class="crayon-c">//Compute the magnitude</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-51"><span class="crayon-h">	</span><span class="crayon-c">//planes[0]=Re(DFT(I)), planes[1]=Im(DFT(I))</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-52"><span class="crayon-h">	</span><span class="crayon-c">//magnitude=sqrt(Re^2+Im^2)</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-53"><span class="crayon-h">	</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">comImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-54"><span class="crayon-h">	</span><span class="crayon-e">magnitude</span><span class="crayon-sy">(</span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-55">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-56"><span class="crayon-h">	</span><span class="crayon-c">//Switch to logarithmic scale, for better visual results</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-57"><span class="crayon-h">	</span><span class="crayon-c">//M2=log(1+M1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-58"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-59"><span class="crayon-h">	</span><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">Scalar</span><span class="crayon-o">::</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-60"><span class="crayon-h">	</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-61">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-62"><span class="crayon-h">	</span><span class="crayon-c">//Crop the spectrum</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-63"><span class="crayon-h">	</span><span class="crayon-c">//Width and height of magMat should be even, so that they can be divided by 2</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-64"><span class="crayon-h">	</span><span class="crayon-c">//-2 is 11111110 in binary system, operator &amp; make sure width and height are always even</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-65"><span class="crayon-h">	</span><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">magMat</span><span class="crayon-sy">(</span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-66">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-67"><span class="crayon-h">	</span><span class="crayon-c">//Rearrange the quadrants of Fourier image,</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-68"><span class="crayon-h">	</span><span class="crayon-c">//so that the origin is at the center of image,</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-69"><span class="crayon-h">	</span><span class="crayon-c">//and move the high frequency to the corners</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-70"><span class="crayon-h">	</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-71"><span class="crayon-h">	</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-72">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-73"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">q0</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-74"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">q1</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-75"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">q2</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-76"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">q3</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-77">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-78"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">tmp</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-79"><span class="crayon-h">	</span><span class="crayon-v">q0</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-80"><span class="crayon-h">	</span><span class="crayon-v">q2</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-81"><span class="crayon-h">	</span><span class="crayon-v">tmp</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-82">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-83"><span class="crayon-h">	</span><span class="crayon-v">q1</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-84"><span class="crayon-h">	</span><span class="crayon-v">q3</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-85"><span class="crayon-h">	</span><span class="crayon-v">tmp</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-86">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-87"><span class="crayon-h">	</span><span class="crayon-c">//Normalize the magnitude to [0,1], then to[0,255]</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-88"><span class="crayon-h">	</span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_MINMAX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-89"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">magImg</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_8UC1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-90"><span class="crayon-h">	</span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-e">convertTo</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC1</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-91"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"magnitude"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-92"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("imageText_mag.jpg",magImg);</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-93">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-94"><span class="crayon-h">	</span><span class="crayon-c">//Turn into binary image</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-95"><span class="crayon-h">	</span><span class="crayon-e">threshold</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">GRAY_THRESH</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-v">CV_THRESH_BINARY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-96"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"mag_binary"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-97"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("imageText_bin.jpg",magImg);</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-98">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-99"><span class="crayon-h">	</span><span class="crayon-c">//Find lines with Hough Transformation</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-100"><span class="crayon-h">	</span><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-v">Vec2f</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-101"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">pi180</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">180</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-102"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-e">linImg</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-103"><span class="crayon-h">	</span><span class="crayon-e">HoughLines</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">pi180</span><span class="crayon-sy">,</span><span class="crayon-v">HOUGH_VOTE</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-104"><span class="crayon-h">	</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">numLines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-105"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">&lt;</span><span class="crayon-v">numLines</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-106"><span class="crayon-h">	</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-107"><span class="crayon-h">		</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">rho</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-108"><span class="crayon-h">		</span><span class="crayon-e">Point </span><span class="crayon-v">pt1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pt2</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-109"><span class="crayon-h">		</span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-110"><span class="crayon-h">		</span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">a*</span><span class="crayon-v">rho</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">b*</span><span class="crayon-v">rho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-111"><span class="crayon-h">		</span><span class="crayon-v">pt1</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-112"><span class="crayon-h">		</span><span class="crayon-v">pt1</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-113"><span class="crayon-h">		</span><span class="crayon-v">pt2</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-114"><span class="crayon-h">		</span><span class="crayon-v">pt2</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-115"><span class="crayon-h">		</span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">linImg</span><span class="crayon-sy">,</span><span class="crayon-v">pt1</span><span class="crayon-sy">,</span><span class="crayon-v">pt2</span><span class="crayon-sy">,</span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-116"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-117"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"lines"</span><span class="crayon-sy">,</span><span class="crayon-v">linImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-118"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("imageText_line.jpg",linImg);</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-119"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-120"><span class="crayon-h">		</span><span class="crayon-v">cout</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-s">"found three angels:"</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-121"><span class="crayon-h">		</span><span class="crayon-v">cout</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">180</span><span class="crayon-o">/</span><span class="crayon-v">CV_PI</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">180</span><span class="crayon-o">/</span><span class="crayon-v">CV_PI</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">180</span><span class="crayon-o">/</span><span class="crayon-v">CV_PI</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-122"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-123">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-124"><span class="crayon-h">	</span><span class="crayon-c">//Find the proper angel from the three found angels</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-125"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-126"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">90</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-127"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">pi2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-128"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">&lt;</span><span class="crayon-v">numLines</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-129"><span class="crayon-h">	</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-130"><span class="crayon-h">		</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-131"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-o">-</span><span class="crayon-v">pi2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-132"><span class="crayon-h">			</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-133"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-134"><span class="crayon-h">			</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-135"><span class="crayon-h">			</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-136"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-137"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-138">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-139"><span class="crayon-h">	</span><span class="crayon-c">//Calculate the rotation angel</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-140"><span class="crayon-h">	</span><span class="crayon-c">//The image has to be square,</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-141"><span class="crayon-h">	</span><span class="crayon-c">//so that the rotation angel can be calculate right</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-142"><span class="crayon-h">	</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">&lt;</span><span class="crayon-i">pi2</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">-</span><span class="crayon-v">CV_PI</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-143"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">pi2</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-144"><span class="crayon-h">		</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angelT</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e ">rows*</span><span class="crayon-e">tan</span><span class="crayon-sy">(</span><span class="crayon-v">angel</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-145"><span class="crayon-h">		</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">atan</span><span class="crayon-sy">(</span><span class="crayon-v">angelT</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-146"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-147"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angelD</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">angel*</span><span class="crayon-cn">180</span><span class="crayon-o">/</span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-148"><span class="crayon-h">	</span><span class="crayon-v">cout</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-s">"the rotation angel to be applied:"</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">angelD</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-v">endl</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-149">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-150"><span class="crayon-h">	</span><span class="crayon-c">//Rotate the image to recover</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-151"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">rotMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getRotationMatrix2D</span><span class="crayon-sy">(</span><span class="crayon-v">center</span><span class="crayon-sy">,</span><span class="crayon-v">angelD</span><span class="crayon-sy">,</span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-152"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">dstImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Mat</span><span class="crayon-o">::</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-153"><span class="crayon-h">	</span><span class="crayon-e">warpAffine</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-v">dstImg</span><span class="crayon-sy">,</span><span class="crayon-v">rotMat</span><span class="crayon-sy">,</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-154"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"result"</span><span class="crayon-sy">,</span><span class="crayon-v">dstImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-155"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("imageText_D.jpg",dstImg);</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-156"><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-157"><span class="crayon-h">	</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-158">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d1c108515999-159"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d1c108515999-160"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0530 seconds] -->
<p></p>
<hr>
<p>
	<strong><span style="font-size:16px;">过程</span></strong><br>
	<strong><span style="font-size:14px;">读取图片</span></strong>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d37024498532" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Mat srcImg = imread(filename, CV_LOAD_IMAGE_GRAYSCALE);
	if(srcImg.empty())
		return -1;</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d37024498532-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d37024498532-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d37024498532-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d37024498532-1"><span class="crayon-e">Mat </span><span class="crayon-v">srcImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_LOAD_IMAGE_GRAYSCALE</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d37024498532-2"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-583f9b5b33d37024498532-3"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; srcImg.empty()用来判断是否成功读进图像，如果srcImg中没有数据，在后面的步骤会产生内存错误。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 由于处理的是文本，彩色信息不会提供额外帮助，所以要用CV_LOAD_IMAGE_GRAYSCALE表明以灰度形式读进图像。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 假定读取的图像如下：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-rotation.jpg" data-rel="lightbox-0" title=""><img alt="english-rotation" class="aligncenter size-full wp-image-377" height="328" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-rotation.jpg" width="655" srcset="http://johnhany.net/wp-content/uploads/2013/11/english-rotation.jpg 655w, http://johnhany.net/wp-content/uploads/2013/11/english-rotation-300x150.jpg 300w" sizes="(max-width: 655px) 100vw, 655px"></a>
</p>
<p>
	<strong><span style="font-size:14px;">旋转原图像(可选)</span></strong>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d45965362224" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Point center(srcImg.cols/2, srcImg.rows/2);

#ifdef DEGREE
	//Rotate source image
	Mat rotMatS = getRotationMatrix2D(center, DEGREE, 1.0);
	warpAffine(srcImg, srcImg, rotMatS, srcImg.size(), 1, 0, Scalar(255,255,255));
	imshow("RotatedSrc", srcImg);
	//imwrite("H:\\imageText_02_R.jpg",srcImg);
#endif</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d45965362224-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d45965362224-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d45965362224-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d45965362224-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d45965362224-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d45965362224-6">6</div><div class="crayon-num" data-line="crayon-583f9b5b33d45965362224-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d45965362224-8">8</div><div class="crayon-num" data-line="crayon-583f9b5b33d45965362224-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d45965362224-1"><span class="crayon-e">Point </span><span class="crayon-e">center</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d45965362224-2">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d45965362224-3"><span class="crayon-p">#ifdef DEGREE</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d45965362224-4"><span class="crayon-h">	</span><span class="crayon-c">//Rotate source image</span></div><div class="crayon-line" id="crayon-583f9b5b33d45965362224-5"><span class="crayon-h">	</span><span class="crayon-e">Mat </span><span class="crayon-v">rotMatS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getRotationMatrix2D</span><span class="crayon-sy">(</span><span class="crayon-v">center</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">DEGREE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d45965362224-6"><span class="crayon-h">	</span><span class="crayon-e">warpAffine</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotMatS</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d45965362224-7"><span class="crayon-h">	</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"RotatedSrc"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d45965362224-8"><span class="crayon-h">	</span><span class="crayon-c">//imwrite("H:\\imageText_02_R.jpg",srcImg);</span></div><div class="crayon-line" id="crayon-583f9b5b33d45965362224-9"><span class="crayon-p">#endif</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 如果手头没有这样的倾斜图像，可以选择一张正放的文本图像，再把第12行#define DEGREE那行前的注释符号去掉。然后这部分代码就会把所给的图像旋转你规定的角度，再交给后面处理。
</p>
<p>
	<strong><span style="font-size:14px;">图像延扩</span></strong>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d53468036737" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Mat padded;
int opWidth = getOptimalDFTSize(srcImg.rows);
int opHeight = getOptimalDFTSize(srcImg.cols);
copyMakeBorder(srcImg, padded, 0, opWidth-srcImg.rows, 0, opHeight-srcImg.cols, BORDER_CONSTANT, Scalar::all(0));</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d53468036737-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d53468036737-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d53468036737-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d53468036737-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d53468036737-1"><span class="crayon-e">Mat </span><span class="crayon-v">padded</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d53468036737-2"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">opWidth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getOptimalDFTSize</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d53468036737-3"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">opHeight</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getOptimalDFTSize</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d53468036737-4"><span class="crayon-e">copyMakeBorder</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">opWidth</span><span class="crayon-o">-</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">opHeight</span><span class="crayon-o">-</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">BORDER_CONSTANT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Scalar</span><span class="crayon-o">::</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; OpenCV中的DFT采用的是快速算法，这种算法要求图像的尺寸是2、3和5的倍数时处理速度最快。所以需要用getOptimalDFTSize()找到最适合的尺寸，然后用copyMakeBorder()填充多余的部分。这里是让原图像和扩大的图像左上角对齐。填充的颜色如果是纯色对变换结果的影响不会很大，后面寻找倾斜线的过程又会完全忽略这一点影响。
</p>
<p>
	<strong><span style="font-size:14px;">DFT</span></strong>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d5c196057718" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Mat planes[] = {Mat_&lt;float&gt;(padded), Mat::zeros(padded.size(), CV_32F)};
Mat comImg;

merge(planes,2,comImg);

dft(comImg, comImg);</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d5c196057718-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d5c196057718-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d5c196057718-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d5c196057718-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d5c196057718-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d5c196057718-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d5c196057718-1"><span class="crayon-e">Mat </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">Mat_</span><span class="crayon-o">&lt;</span><span class="crayon-t">float</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-v">padded</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Mat</span><span class="crayon-o">::</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">padded</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_32F</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d5c196057718-2"><span class="crayon-e">Mat </span><span class="crayon-v">comImg</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d5c196057718-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d5c196057718-4"><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">planes</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-v">comImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d5c196057718-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d5c196057718-6"><span class="crayon-e">dft</span><span class="crayon-sy">(</span><span class="crayon-v">comImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">comImg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; DFT要分别计算实部和虚部，把要处理的图像作为输入的实部、一个全零的图像作为输入的虚部。dft()输入和输出应该分别为单张图像，所以要先用merge()把实虚部图像合并，分别处于图像comImg的两个通道内。计算得到的实虚部仍然保存在comImg的两个通道内。
</p>
<p>
	<strong><span style="font-size:14px;">获得DFT图像</span></strong>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d67455641464" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">split(comImg, planes);
magnitude(planes[0], planes[1], planes[0]);

Mat magMat = planes[0];
magMat += Scalar::all(1);
log(magMat, magMat);</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d67455641464-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d67455641464-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d67455641464-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d67455641464-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d67455641464-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d67455641464-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d67455641464-1"><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">comImg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d67455641464-2"><span class="crayon-e">magnitude</span><span class="crayon-sy">(</span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d67455641464-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d67455641464-4"><span class="crayon-e">Mat </span><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">planes</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d67455641464-5"><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">Scalar</span><span class="crayon-o">::</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d67455641464-6"><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 一般都会用幅度图像来表示图像傅里叶的变换结果（傅里叶谱）。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 幅度的计算公式：magnitude = sqrt(Re(DFT)^2 + Im(DFT)^2)。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 由于幅度的变化范围很大，而一般图像亮度范围只有[0,255]，容易造成一大片漆黑，只有几个点很亮。所以要用log函数把数值的范围缩小。
</p>
<p>
	&nbsp;
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d78729315063" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">magMat = magMat(Rect(0, 0, magMat.cols &amp; -2, magMat.rows &amp; -2));

int cx = magMat.cols/2;
int cy = magMat.rows/2;

Mat q0(magMat, Rect(0, 0, cx, cy));
Mat q1(magMat, Rect(0, cy, cx, cy));
Mat q2(magMat, Rect(cx, cy, cx, cy));
Mat q3(magMat, Rect(cx, 0, cx, cy));

Mat tmp;
q0.copyTo(tmp);
q2.copyTo(q0);
tmp.copyTo(q2);

q1.copyTo(tmp);
q3.copyTo(q1);
tmp.copyTo(q3);

normalize(magMat, magMat, 0, 1, CV_MINMAX);
Mat magImg(magMat.size(), CV_8UC1);
magMat.convertTo(magImg,CV_8UC1,255,0);</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-6">6</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-8">8</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-10">10</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-12">12</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-14">14</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-16">16</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-18">18</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-20">20</div><div class="crayon-num" data-line="crayon-583f9b5b33d78729315063-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d78729315063-22">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d78729315063-1"><span class="crayon-v">magMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">magMat</span><span class="crayon-sy">(</span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-2">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-3"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-4"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-v">rows</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-6"><span class="crayon-e">Mat </span><span class="crayon-e">q0</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-7"><span class="crayon-e">Mat </span><span class="crayon-e">q1</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-8"><span class="crayon-e">Mat </span><span class="crayon-e">q2</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-9"><span class="crayon-e">Mat </span><span class="crayon-e">q3</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rect</span><span class="crayon-sy">(</span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-10">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-11"><span class="crayon-e">Mat </span><span class="crayon-v">tmp</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-12"><span class="crayon-v">q0</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-13"><span class="crayon-v">q2</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-14"><span class="crayon-v">tmp</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-16"><span class="crayon-v">q1</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-17"><span class="crayon-v">q3</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-18"><span class="crayon-v">tmp</span><span class="crayon-sy">.</span><span class="crayon-e">copyTo</span><span class="crayon-sy">(</span><span class="crayon-v">q3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-20"><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">magMat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_MINMAX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d78729315063-21"><span class="crayon-e">Mat </span><span class="crayon-e">magImg</span><span class="crayon-sy">(</span><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CV_8UC1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d78729315063-22"><span class="crayon-v">magMat</span><span class="crayon-sy">.</span><span class="crayon-e">convertTo</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC1</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0089 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; dft()直接获得的结果中，低频部分位于四角，高频部分位于中间。习惯上会把图像做四等份，互相对调，使低频部分位于图像中心，也就是让频域原点位于中心。
</p>
<p>
	&nbsp;
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/fft-mag.png" data-rel="lightbox-1" title=""><img alt="fft-mag" class="aligncenter size-full wp-image-379" height="227" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/fft-mag.png" width="505" srcset="http://johnhany.net/wp-content/uploads/2013/11/fft-mag.png 505w, http://johnhany.net/wp-content/uploads/2013/11/fft-mag-300x135.png 300w" sizes="(max-width: 505px) 100vw, 505px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 虽然用log()缩小了数据范围，但仍然不能保证数值都落在[0,255]之内，所以要先用normalize()规范化到[0,1]内，再用convertTo()把小数映射到[0,255]内的整数。结果保存在一幅单通道图像内：
</p>
<p>
	&nbsp;
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-mag.jpg" data-rel="lightbox-2" title=""><img alt="english-mag" class="aligncenter size-full wp-image-380" height="480" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-mag.jpg" width="480" srcset="http://johnhany.net/wp-content/uploads/2013/11/english-mag.jpg 480w, http://johnhany.net/wp-content/uploads/2013/11/english-mag-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/english-mag-300x300.jpg 300w" sizes="(max-width: 480px) 100vw, 480px"></a>
</p>
<p>
	<strong><span style="font-size:14px;">Hough直线检测</span></strong><br>
	&nbsp; &nbsp; &nbsp; &nbsp; 从傅里叶谱可以明显地看到一条过中心点的倾斜直线。要想求出这个倾斜角，首先要在图像上找出这条直线。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 一个很方便的方法是采用霍夫（Hough）变换检测直线。
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d87090987913" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">threshold(magImg,magImg,GRAY_THRESH,255,CV_THRESH_BINARY);</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d87090987913-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d87090987913-1"><span class="crayon-e">threshold</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">GRAY_THRESH</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-v">CV_THRESH_BINARY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; Hough变换要求输入图像是二值的，所以要用threshold()把图像二值化。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 二值化的一种结果：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-binary.jpg" data-rel="lightbox-3" title=""><img alt="english-binary" class="aligncenter size-full wp-image-381" height="480" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-binary.jpg" width="480" srcset="http://johnhany.net/wp-content/uploads/2013/11/english-binary.jpg 480w, http://johnhany.net/wp-content/uploads/2013/11/english-binary-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/english-binary-300x300.jpg 300w" sizes="(max-width: 480px) 100vw, 480px"></a>
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33d96251696728" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">vector&lt;Vec2f&gt; lines;
float pi180 = (float)CV_PI/180;
Mat linImg(magImg.size(),CV_8UC3);
HoughLines(magImg,lines,1,pi180,HOUGH_VOTE,0,0);
int numLines = lines.size();
for(int l=0; l&lt;numLines; l++)
{
	float rho = lines[l][0], theta = lines[l][1];
	Point pt1, pt2;
	double a = cos(theta), b = sin(theta);
	double x0 = a*rho, y0 = b*rho;
	pt1.x = cvRound(x0 + 1000*(-b));
	pt1.y = cvRound(y0 + 1000*(a));
	pt2.x = cvRound(x0 - 1000*(-b));
	pt2.y = cvRound(y0 - 1000*(a));
	line(linImg,pt1,pt2,Scalar(255,0,0),3,8,0);
}</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-6">6</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-8">8</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-10">10</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-12">12</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-14">14</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33d96251696728-16">16</div><div class="crayon-num" data-line="crayon-583f9b5b33d96251696728-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33d96251696728-1"><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-v">Vec2f</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-2"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">pi180</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">180</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-3"><span class="crayon-e">Mat </span><span class="crayon-e">linImg</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-4"><span class="crayon-e">HoughLines</span><span class="crayon-sy">(</span><span class="crayon-v">magImg</span><span class="crayon-sy">,</span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">pi180</span><span class="crayon-sy">,</span><span class="crayon-v">HOUGH_VOTE</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-5"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">numLines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-6"><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">&lt;</span><span class="crayon-v">numLines</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-7"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-8"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">rho</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-9"><span class="crayon-h">	</span><span class="crayon-e">Point </span><span class="crayon-v">pt1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pt2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-10"><span class="crayon-h">	</span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-11"><span class="crayon-h">	</span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">a*</span><span class="crayon-v">rho</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">b*</span><span class="crayon-v">rho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-12"><span class="crayon-h">	</span><span class="crayon-v">pt1</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-13"><span class="crayon-h">	</span><span class="crayon-v">pt1</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-14"><span class="crayon-h">	</span><span class="crayon-v">pt2</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-15"><span class="crayon-h">	</span><span class="crayon-v">pt2</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cvRound</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33d96251696728-16"><span class="crayon-h">	</span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">linImg</span><span class="crayon-sy">,</span><span class="crayon-v">pt1</span><span class="crayon-sy">,</span><span class="crayon-v">pt2</span><span class="crayon-sy">,</span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33d96251696728-17"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0098 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 这一部分用HoughLines()检测图像中可能存在的直线，并把直线参数保存在向量组lines中，然后绘制出找到的直线。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 两个参数GRAY_THRESH和HOUGH_VOTE需要手动指定，不同的图像需要设置不同的参数，同一段文本旋转不同的角度也需要不同的参数。GRAY_THRESH越大，二值化的阈值就越高；HOUGH_VOTE越大，霍夫检测的投票数就越高（需要更多的共线点来确定一条直线）。说白了，如果发现二值化图像中直线附近有很多散点，就要适当提高GRAY_THRESH；如果发现从二值图像的一条直线上检测到了几条角度相差很小的直线，就需要适当提高HOUGH_VOTE。我们希望得到的结果时刚好检测到三条直线（有时只能检测到一条直线，后面会给出一个例子）。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 检测到的直线：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-line.jpg" data-rel="lightbox-4" title=""><img alt="english-line" class="aligncenter size-full wp-image-382" height="480" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-line.jpg" width="480" srcset="http://johnhany.net/wp-content/uploads/2013/11/english-line.jpg 480w, http://johnhany.net/wp-content/uploads/2013/11/english-line-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/english-line-300x300.jpg 300w" sizes="(max-width: 480px) 100vw, 480px"></a>
</p>
<p>
	<strong><span style="font-size:14px;">计算倾斜角</span></strong><br>
	&nbsp; &nbsp; &nbsp; &nbsp; 上面得到了三个角度，一个是0度，一个是90度，另一个就是我们所需要的倾斜角。要把这个角找出来，而且要考虑误差。
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33da8198351397" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">float angel=0;
float piThresh = (float)CV_PI/90;
float pi2 = CV_PI/2;
for(int l=0; l&lt;numLines; l++)
{
	float theta = lines[l][1];
	if(abs(theta) &lt; piThresh || abs(theta-pi2) &lt; piThresh)
		continue;
	else{
		angel = theta;
		break;
	}
}

angel = angel&lt;pi2 ? angel : angel-CV_PI;
if(angel != pi2){
	float angelT = srcImg.rows*tan(angel)/srcImg.cols;
	angel = atan(angelT);
}
float angelD = angel*180/(float)CV_PI;</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-4">4</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-6">6</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-8">8</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-10">10</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-12">12</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-14">14</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-16">16</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-18">18</div><div class="crayon-num" data-line="crayon-583f9b5b33da8198351397-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33da8198351397-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33da8198351397-1"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-2"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">90</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-3"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">pi2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">CV_PI</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-4"><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">&lt;</span><span class="crayon-v">numLines</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-5"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-6"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">[</span><span class="crayon-v">l</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-7"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-o">-</span><span class="crayon-v">pi2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">piThresh</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-8"><span class="crayon-h">		</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-9"><span class="crayon-h">	</span><span class="crayon-st">else</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-10"><span class="crayon-h">		</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-11"><span class="crayon-h">		</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-12"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-13"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-14">&nbsp;</div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-15"><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">&lt;</span><span class="crayon-i">pi2</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">angel</span><span class="crayon-o">-</span><span class="crayon-v">CV_PI</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-16"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">pi2</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-17"><span class="crayon-h">	</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angelT</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e ">rows*</span><span class="crayon-e">tan</span><span class="crayon-sy">(</span><span class="crayon-v">angel</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-v">cols</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-18"><span class="crayon-h">	</span><span class="crayon-v">angel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">atan</span><span class="crayon-sy">(</span><span class="crayon-v">angelT</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33da8198351397-19"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33da8198351397-20"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">angelD</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">angel*</span><span class="crayon-cn">180</span><span class="crayon-o">/</span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">)</span><span class="crayon-v">CV_PI</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0132 seconds] -->
<p></p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 由于DFT的特点，只有输入图像是正方形时，检测到的角才是文本真正旋转的角度。但我们的输入图像不一定是正方形的，所以要根据图像的长宽比改变这个角度。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 还有一个需要注意的细节，虽然HoughLines()输出的倾斜角在[0,180)之间，但在[0,90]和(90,180)之间这个角的含义是不同的。请看图示：
</p>
<p>
	&nbsp;
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/hough-transformation.png" data-rel="lightbox-5" title=""><img alt="hough-transformation" class="aligncenter size-full wp-image-383" height="349" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/hough-transformation.png" width="531" srcset="http://johnhany.net/wp-content/uploads/2013/11/hough-transformation.png 531w, http://johnhany.net/wp-content/uploads/2013/11/hough-transformation-300x197.png 300w" sizes="(max-width: 531px) 100vw, 531px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 当倾斜角大于90度时，(180-倾斜角)才是直线相对竖直方向的偏离角度。在OpenCV中，逆时针旋转，角度为正。要把图像转回去，这个角度就变成了(倾斜角-180)。<br>
	<strong><span style="font-size:14px;">校正图像</span></strong><br>
	&nbsp; &nbsp; &nbsp; &nbsp; 最后一步，当然是把图像转回去~
</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-583f9b5b33db3967685172" class="crayon-syntax crayon-theme-visual-assist crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="max-width: 1240px; margin: 12px auto; float: none; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="切换是否显示行编号"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码" style="display: none;"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon" style="background-image: url(&quot;file:///C:/Users/wangchun/Desktop/%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5/images/toolbar/buttons@2x.png&quot;); background-size: 48px 128px;"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Mat rotMat = getRotationMatrix2D(center,angelD,1.0);
Mat dstImg = Mat::ones(srcImg.size(),CV_8UC3);
warpAffine(srcImg,dstImg,rotMat,srcImg.size(),1,0,Scalar(255,255,255));</textarea></div>
			<div class="crayon-main" style="max-width: 1240px; position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-583f9b5b33db3967685172-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-583f9b5b33db3967685172-2">2</div><div class="crayon-num" data-line="crayon-583f9b5b33db3967685172-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-583f9b5b33db3967685172-1"><span class="crayon-e">Mat </span><span class="crayon-v">rotMat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getRotationMatrix2D</span><span class="crayon-sy">(</span><span class="crayon-v">center</span><span class="crayon-sy">,</span><span class="crayon-v">angelD</span><span class="crayon-sy">,</span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-583f9b5b33db3967685172-2"><span class="crayon-e">Mat </span><span class="crayon-v">dstImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Mat</span><span class="crayon-o">::</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-v">CV_8UC3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-583f9b5b33db3967685172-3"><span class="crayon-e">warpAffine</span><span class="crayon-sy">(</span><span class="crayon-v">srcImg</span><span class="crayon-sy">,</span><span class="crayon-v">dstImg</span><span class="crayon-sy">,</span><span class="crayon-v">rotMat</span><span class="crayon-sy">,</span><span class="crayon-v">srcImg</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-e">Scalar</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p></p>
<p>
	&nbsp;
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 先用getRotationMatrix2D()获得一个2*3的仿射变换矩阵，再把这个矩阵输入warpAffine()，做一个单纯旋转的仿射变换。warpAffine()的最后一个参数Scalar(255,255,255)是把由于旋转产生的空白用白色填充。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 校正的结果：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-correction.jpg" data-rel="lightbox-6" title=""><img alt="english-correction" class="aligncenter size-full wp-image-384" height="328" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/english-correction.jpg" width="655" srcset="http://johnhany.net/wp-content/uploads/2013/11/english-correction.jpg 655w, http://johnhany.net/wp-content/uploads/2013/11/english-correction-300x150.jpg 300w" sizes="(max-width: 655px) 100vw, 655px"></a>
</p>
<hr>
<p>
	<strong><span style="font-size:16px;">一个检测单条直线的例子</span></strong><br>
	<span style="font-size:14px;">原始图像：</span>
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-rotation.jpg" data-rel="lightbox-7" title=""><img alt="single-english-rotation" class="aligncenter size-full wp-image-385" height="400" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-rotation.jpg" width="400" srcset="http://johnhany.net/wp-content/uploads/2013/11/single-english-rotation.jpg 400w, http://johnhany.net/wp-content/uploads/2013/11/single-english-rotation-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/single-english-rotation-300x300.jpg 300w" sizes="(max-width: 400px) 100vw, 400px"></a>
</p>
<p>
	傅里叶谱：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-mag.jpg" data-rel="lightbox-8" title=""><img alt="single-english-mag" class="aligncenter size-full wp-image-386" height="400" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-mag.jpg" width="400" srcset="http://johnhany.net/wp-content/uploads/2013/11/single-english-mag.jpg 400w, http://johnhany.net/wp-content/uploads/2013/11/single-english-mag-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/single-english-mag-300x300.jpg 300w" sizes="(max-width: 400px) 100vw, 400px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 只有一条明显的直线。还好仅有的这条直线正是我们所需要的。<br>
	检测直线：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-line.jpg" data-rel="lightbox-9" title=""><img alt="single-english-line" class="aligncenter size-full wp-image-387" height="400" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-line.jpg" width="400" srcset="http://johnhany.net/wp-content/uploads/2013/11/single-english-line.jpg 400w, http://johnhany.net/wp-content/uploads/2013/11/single-english-line-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/single-english-line-300x300.jpg 300w" sizes="(max-width: 400px) 100vw, 400px"></a>
</p>
<p>
	校正结果：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-correction.jpg" data-rel="lightbox-10" title=""><img alt="single-english-correction" class="aligncenter size-full wp-image-388" height="400" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/single-english-correction.jpg" width="400" srcset="http://johnhany.net/wp-content/uploads/2013/11/single-english-correction.jpg 400w, http://johnhany.net/wp-content/uploads/2013/11/single-english-correction-150x150.jpg 150w, http://johnhany.net/wp-content/uploads/2013/11/single-english-correction-300x300.jpg 300w" sizes="(max-width: 400px) 100vw, 400px"></a>
</p>
<hr>
<p>
	<strong><span style="font-size:16px;">对中文的效果</span></strong><br>
	&nbsp; &nbsp; &nbsp; &nbsp; 我们来试试看这段程序对中文的校正效果。<br>
	输入图像：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-rotation.jpg" data-rel="lightbox-11" title=""><img alt="chinese-rotation" class="aligncenter size-full wp-image-390" height="274" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-rotation.jpg" width="650" srcset="http://johnhany.net/wp-content/uploads/2013/11/chinese-rotation.jpg 650w, http://johnhany.net/wp-content/uploads/2013/11/chinese-rotation-300x126.jpg 300w" sizes="(max-width: 650px) 100vw, 650px"></a>
</p>
<p>
	傅里叶谱：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-mag.jpg" data-rel="lightbox-12" title=""><img alt="chinese-mag" class="aligncenter size-full wp-image-391" height="275" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-mag.jpg" width="660" srcset="http://johnhany.net/wp-content/uploads/2013/11/chinese-mag.jpg 660w, http://johnhany.net/wp-content/uploads/2013/11/chinese-mag-300x125.jpg 300w" sizes="(max-width: 660px) 100vw, 660px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 可以发现有许多条平行的亮线，其中过频域原点的那条长度最长，最容易检测出来。<br>
	检测直线：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-line.jpg" data-rel="lightbox-13" title=""><img alt="chinese-line" class="aligncenter size-full wp-image-392" height="275" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-line.jpg" width="660" srcset="http://johnhany.net/wp-content/uploads/2013/11/chinese-line.jpg 660w, http://johnhany.net/wp-content/uploads/2013/11/chinese-line-300x125.jpg 300w" sizes="(max-width: 660px) 100vw, 660px"></a>
</p>
<p>
	校正结果：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-correction.jpg" data-rel="lightbox-14" title=""><img alt="chinese-correction" class="aligncenter size-full wp-image-393" height="274" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/chinese-correction.jpg" width="650" srcset="http://johnhany.net/wp-content/uploads/2013/11/chinese-correction.jpg 650w, http://johnhany.net/wp-content/uploads/2013/11/chinese-correction-300x126.jpg 300w" sizes="(max-width: 650px) 100vw, 650px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 虽然中文和英文在文字上有很大的不同，但字母（或者文字）的高度比较一致，使得行与行之间的分隔很明显。所以它们的频域特征是相似的。
</p>
<hr>
<p>
	<strong><span style="font-size:16px;">对其他语言文字的效果</span></strong><br>
	&nbsp; &nbsp; &nbsp; &nbsp; 我从IMDB.com摘取影片《教父》的英文介绍，然后用谷歌翻译成其他文字进行测试。<br>
	阿拉伯语
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-rotation.jpg" data-rel="lightbox-15" title=""><img alt="arabic-rotation" class="aligncenter size-full wp-image-389" height="273" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-rotation.jpg" width="609" srcset="http://johnhany.net/wp-content/uploads/2013/11/arabic-rotation.jpg 609w, http://johnhany.net/wp-content/uploads/2013/11/arabic-rotation-300x134.jpg 300w" sizes="(max-width: 609px) 100vw, 609px"></a>
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-mag.jpg" data-rel="lightbox-16" title=""><img alt="arabic-mag" class="aligncenter size-full wp-image-394" height="275" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-mag.jpg" width="612" srcset="http://johnhany.net/wp-content/uploads/2013/11/arabic-mag.jpg 612w, http://johnhany.net/wp-content/uploads/2013/11/arabic-mag-300x135.jpg 300w" sizes="(max-width: 612px) 100vw, 612px"></a>
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-line.jpg" data-rel="lightbox-17" title=""><img alt="arabic-line" class="aligncenter size-full wp-image-395" height="275" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/arabic-line.jpg" width="612" srcset="http://johnhany.net/wp-content/uploads/2013/11/arabic-line.jpg 612w, http://johnhany.net/wp-content/uploads/2013/11/arabic-line-300x135.jpg 300w" sizes="(max-width: 612px) 100vw, 612px"></a>
</p>
<p>
	<strong><span style="font-size:14px;">一枚反例</span></strong><br>
	老挝语：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-rotation.jpg" data-rel="lightbox-18" title=""><img alt="lao-rotation" class="aligncenter size-full wp-image-396" height="351" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-rotation.jpg" width="619" srcset="http://johnhany.net/wp-content/uploads/2013/11/lao-rotation.jpg 619w, http://johnhany.net/wp-content/uploads/2013/11/lao-rotation-300x170.jpg 300w" sizes="(max-width: 619px) 100vw, 619px"></a>
</p>
<p>
	傅里叶谱：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-mag.jpg" data-rel="lightbox-19" title=""><img alt="lao-mag" class="aligncenter size-full wp-image-397" height="367" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-mag.jpg" width="619" srcset="http://johnhany.net/wp-content/uploads/2013/11/lao-mag.jpg 619w, http://johnhany.net/wp-content/uploads/2013/11/lao-mag-300x178.jpg 300w" sizes="(max-width: 619px) 100vw, 619px"></a>
</p>
<p>
	一种二值化的结果：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-binary.jpg" data-rel="lightbox-20" title=""><img alt="lao-binary" class="aligncenter size-full wp-image-398" height="367" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-binary.jpg" width="619" srcset="http://johnhany.net/wp-content/uploads/2013/11/lao-binary.jpg 619w, http://johnhany.net/wp-content/uploads/2013/11/lao-binary-300x178.jpg 300w" sizes="(max-width: 619px) 100vw, 619px"></a>
</p>
<p>
	直线检测：
</p>
<p>
	<a href="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-line.jpg" data-rel="lightbox-21" title=""><img alt="lao-line" class="aligncenter size-full wp-image-399" height="367" src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/lao-line.jpg" width="619" srcset="http://johnhany.net/wp-content/uploads/2013/11/lao-line.jpg 619w, http://johnhany.net/wp-content/uploads/2013/11/lao-line-300x178.jpg 300w" sizes="(max-width: 619px) 100vw, 619px"></a>
</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; 这种文字的很多字母的上下方多了很多“笔画”（我不知道该怎么称呼那些小曲线），让行与行之间的分离变得不明显，使得频域特征变得不明显。<br>
	&nbsp; &nbsp; &nbsp; &nbsp; 虽然用肉眼可以看出傅里叶谱中存在一条倾斜的直线，但它的亮度太低，二值化过程很难排除噪声，导致直线检测会首先检出噪声产生的直线。这也是我的程序目前受限之处。需要增加一个过滤散点噪声的步骤以增加程序的适用范围。
</p>
<hr>
<p>
	参考：<a href="http://docs.opencv.org/doc/tutorials/core/discrete_fourier_transform/discrete_fourier_transform.html" target="_blank">Discrete Fourier Transform — OpenCV 2.4.7.0 documentation</a>
</p>
<p>
	代码还可以在这里下载：<a href="https://github.com/johnhany/textRotCorrect">https://github.com/johnhany/textRotCorrect</a>
</p>
<hr>
<p>
	<span style="background-color:#FFFF00;">2014.1.3更新：</span>
</p>
<p>
	<span style="background-color:#FFFF00;">&nbsp; &nbsp; &nbsp; &nbsp; 由于文章内的图片右下角存在水印，若直接使用文章内的图片进行处理会使频域原点附近增加一团亮点，妨碍直线的检出。而且为了节省空间，图片是经过缩小的，使得字母的边缘变得模糊，频域特征也减弱。为此我提供了十幅没有水印的图片，供想要亲手实验的朋友使用。</span><a href="http://pan.baidu.com/s/1bnaNmmb" target="_blank"><span style="background-color:#FFFF00;">下载链接</span></a></p>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="cat-links">类别：<a href="http://johnhany.net/category/tech-article/image-processing/" rel="category tag">图像处理</a></span><span class="tags-links">标签：<a href="http://johnhany.net/tag/opencv-2/" rel="tag">opencv</a>, <a href="http://johnhany.net/tag/%e6%96%87%e6%9c%ac%e5%a4%84%e7%90%86/" rel="tag">文本处理</a></span>	</footer><!-- .entry-footer -->
    </div>
</article><!-- #post-## -->

			
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><div class="nav-previous"><a href="http://johnhany.net/2013/11/sweep-algorithm-for-segments-intersection/" rel="prev">N条线段求交的扫描线算法</a></div><div class="nav-next"><a href="http://johnhany.net/2013/11/web-crawler-using-java-and-mysql/" rel="next">Java+MySQL实现网络爬虫程序</a></div></div>
	</nav>
			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			共有21条评论		</h2>

		
		<ol class="comment-list">
					<li id="comment-688" class="comment even thread-even depth-1 parent">
			<article id="div-comment-688" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/d9f86e8a76dea81b2452efc69b93e278" class="avatar avatar-64" height="64" width="64">						<b class="fn">ma</b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#comment-688">
							<time datetime="2016-05-31T11:43:33+00:00">
								2016年5月31日 上午11:43							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>	您好，请问一下您使用的这个方法是有没有发过相应的文章，因为我的实验里用到了您的方法，论文的时候需要写这个方法的来源，所以想问一下您这个方法来自您自己发过的文章里的还是其他书本或期刊上的。谢谢您。</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/?replytocom=688#respond" onclick="return addComment.moveForm( &quot;div-comment-688&quot;, &quot;688&quot;, &quot;respond&quot;, &quot;376&quot; )" aria-label="回复给ma">回复</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-692" class="comment byuser comment-author-john-hany bypostauthor odd alt depth-2 parent">
			<article id="div-comment-692" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/7c953409a37c9ecdcc2c349f747248d7" class="avatar avatar-64" height="64" width="64">						<b class="fn"><a href="http://johnhany.net/" rel="external nofollow" class="url">John Hany</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#comment-692">
							<time datetime="2016-06-02T11:14:19+00:00">
								2016年6月2日 上午11:14							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>
	我的方法并不是完全原创，参考的资料也只有文章末尾的那个官方文档页面。那个页面的最后一节只是提到水平与倾斜的文本频谱图像是有差异的，也没有提及相关的文献，我也是自己用代码实验了一下，所以也没有发过相应的文章。某些杂志是允许把网址作为参考文献的，可以按照格式要求直接把这篇文章的链接写上。</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/?replytocom=692#respond" onclick="return addComment.moveForm( &quot;div-comment-692&quot;, &quot;692&quot;, &quot;respond&quot;, &quot;376&quot; )" aria-label="回复给John Hany">回复</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-763" class="comment even depth-3">
			<article id="div-comment-763" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/d9f86e8a76dea81b2452efc69b93e278" class="avatar avatar-64" height="64" width="64">						<b class="fn">ma</b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#comment-763">
							<time datetime="2016-07-13T11:05:19+00:00">
								2016年7月13日 上午11:05							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>	谢谢。</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/?replytocom=763#respond" onclick="return addComment.moveForm( &quot;div-comment-763&quot;, &quot;763&quot;, &quot;respond&quot;, &quot;376&quot; )" aria-label="回复给ma">回复</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-683" class="comment odd alt thread-odd thread-alt depth-1 parent">
			<article id="div-comment-683" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/d9f86e8a76dea81b2452efc69b93e278" class="avatar avatar-64" height="64" width="64">						<b class="fn">ma</b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#comment-683">
							<time datetime="2016-05-28T18:45:20+00:00">
								2016年5月28日 下午6:45							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>	您好，看了您的方法后，我用C语言试用了一下，但是不知道为什么在HoughLines后，呈现出来的图象是全黑的。为了方便，我贴出这部分的代码，不知道哪里出了问题，想向您请教一下。谢谢。</p>
<p>	&nbsp;</p>
<p>	CvMemStorage *storage&nbsp; = cvCreateMemStorage(0);<br>
	&nbsp;CvSeq* lines = NULL;<br>
	&nbsp;float pi180 = (float)CV_PI/180;<br>
	&nbsp;lines =&nbsp;cvHoughLines2(Image,storage,CV_HOUGH_STANDARD,1,pi180,HOUGH_VOTE,0,0); //Image是之前的二值化图象<br>
	IplImage *lineImg;<br>
	&nbsp;lineImg = cvCreateImage(cvGetSize(src),IPL_DEPTH_8U,1);<br>
	&nbsp;int numLines = lines-&gt;total;<br>
	&nbsp;int i=0;<br>
	&nbsp;for(i=0;i&lt;numLines;i++)<br>
	&nbsp; &nbsp;{<br>
	&nbsp; &nbsp; &nbsp;float *line = (float*) cvGetSeqElem(lines,i);<br>
	&nbsp; &nbsp; &nbsp;float rho = line[0];<br>
	&nbsp; &nbsp; &nbsp;float theta = line[1];<br>
	&nbsp; &nbsp; &nbsp;CvPoint pt1,pt2;<br>
	&nbsp; &nbsp; &nbsp;double a = cos(theta), b = sin(theta);<br>
	&nbsp; &nbsp; &nbsp;double x0 = a*rho, y0 = b*rho;<br>
	&nbsp; &nbsp; &nbsp;pt1.x = cvRound(x0+1000*(-b));<br>
	&nbsp; &nbsp; &nbsp;pt1.y = cvRound(y0+1000*(a));<br>
	&nbsp; &nbsp; &nbsp;pt2.x = cvRound(x0-1000*(-b));<br>
	&nbsp; &nbsp; &nbsp;pt2.y = cvRound(y0-1000*(a));<br>
	&nbsp; &nbsp; &nbsp;cvLine(lineImg,pt1,pt2,CV_RGB(255,0,0),3,8,0);<br>
	}<br>
	&nbsp; &nbsp; cvNamedWindow("line",0);<br>
	&nbsp; &nbsp; cvShowImage("line",lineImg);<br>
	&nbsp; &nbsp; cvWaitKey(10000);</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/?replytocom=683#respond" onclick="return addComment.moveForm( &quot;div-comment-683&quot;, &quot;683&quot;, &quot;respond&quot;, &quot;376&quot; )" aria-label="回复给ma">回复</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-693" class="comment byuser comment-author-john-hany bypostauthor even depth-2 parent">
			<article id="div-comment-693" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img src="./OpenCV实现基于傅里叶变换的旋转文本校正 – JohnHany的博客_files/7c953409a37c9ecdcc2c349f747248d7" class="avatar avatar-64" height="64" width="64">						<b class="fn"><a href="http://johnhany.net/" rel="external nofollow" class="url">John Hany</a></b><span class="says">说道：</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://johnhany.net/2013/11/dft-based-text-rotation-correction/#comment-693">
							</a></div></footer></article></li></ol></li></ol></div></main></div></div></div></body></html>